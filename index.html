<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Management System - Google Sheets Integration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <div class="bg-slate-700 text-white p-4 shadow-lg">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">HỆ THỐNG QUẢN LÝ TASK & PROJECT</h1>
            <div class="flex items-center space-x-4">
                <span id="userInfo" class="text-sm">Chưa đăng nhập</span>
                <button id="loginBtn" class="bg-blue-500 px-4 py-2 rounded hover:bg-blue-600 transition">
                    Đăng nhập Google
                </button>
                <button id="logoutBtn" class="bg-red-500 px-4 py-2 rounded hover:bg-red-600 transition hidden">
                    Đăng xuất
                </button>
            </div>
        </div>
    </div>

    <!-- Setup Modal -->
    <div id="setupModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="glass-card rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold mb-6">Cấu hình hệ thống</h2>
            
            <div class="space-y-6">
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
                    <h4 class="font-bold text-blue-800 mb-2">Bước 1: Tạo Google Apps Script Project</h4>
                    <ol class="text-sm text-blue-700 space-y-1">
                        <li>1. Vào <a href="https://script.google.com" target="_blank" class="underline">script.google.com</a></li>
                        <li>2. Tạo New Project</li>
                        <li>3. Copy code Apps Script bên dưới vào editor</li>
                        <li>4. Deploy as Web app với quyền "Anyone"</li>
                        <li>5. Copy Web app URL vào ô bên dưới</li>
                    </ol>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Google Apps Script Web App URL</label>
                    <input type="url" id="webAppUrl" class="w-full p-3 border rounded-lg focus:border-blue-500 focus:outline-none" 
                           placeholder="https://script.google.com/macros/s/YOUR_ID/exec">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Google Sheets ID (từ URL sheet)</label>
                    <input type="text" id="sheetId" class="w-full p-3 border rounded-lg focus:border-blue-500 focus:outline-none" 
                           placeholder="1BUs7miYcAnICMaxvOslgFXYjQFlETuhyWXkoq0t9471">
                </div>

                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                    <h4 class="font-bold text-yellow-800 mb-2">Apps Script Code:</h4>
                    <pre class="text-xs bg-gray-100 p-3 rounded overflow-x-auto"><code>function doPost(e) {
  const sheet = SpreadsheetApp.openById('YOUR_SHEET_ID').getActiveSheet();
  const data = JSON.parse(e.postData.contents);
  
  if (data.action === 'create') {
    sheet.appendRow([
      data.id, data.name, data.assignee, data.project,
      data.startDate, data.endDate, data.status, data.priority,
      data.description, data.creator, data.createdAt
    ]);
    return ContentService.createTextOutput(JSON.stringify({success: true}));
  }
  
  if (data.action === 'read') {
    const values = sheet.getDataRange().getValues();
    return ContentService.createTextOutput(JSON.stringify({data: values}));
  }
  
  if (data.action === 'update') {
    const values = sheet.getDataRange().getValues();
    for (let i = 1; i < values.length; i++) {
      if (values[i][0] === data.id) {
        sheet.getRange(i + 1, 7).setValue(data.status);
        break;
      }
    }
    return ContentService.createTextOutput(JSON.stringify({success: true}));
  }
}</code></pre>
                    <p class="text-xs text-yellow-700 mt-2">Thay YOUR_SHEET_ID bằng ID thực của Google Sheet</p>
                </div>

                <div class="flex space-x-4">
                    <button id="saveSetup" class="flex-1 bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition">
                        Lưu cấu hình
                    </button>
                    <button id="testConnection" class="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition">
                        Test kết nối
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto p-6">
        <!-- Connection Status -->
        <div id="connectionStatus" class="glass-card rounded-lg p-4 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-3 h-3 bg-red-500 rounded-full" id="statusDot"></div>
                    <span id="statusText">Chưa cấu hình Apps Script</span>
                </div>
                <button id="setupBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">
                    Cấu hình
                </button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="glass-card rounded-lg mb-6">
            <div class="flex border-b" id="navTabs">
                <button class="tab-btn active px-6 py-3 font-medium border-b-2 border-blue-500 text-blue-600" data-tab="dashboard">
                    TỔNG QUAN
                </button>
                <button class="tab-btn px-6 py-3 font-medium text-gray-600 hover:text-blue-600" data-tab="create">
                    TẠO TASK
                </button>
                <button class="tab-btn px-6 py-3 font-medium text-gray-600 hover:text-blue-600" data-tab="manage">
                    QUẢN LÝ TASK
                </button>
            </div>
        </div>

        <!-- Tab Contents -->
        <div id="tabContents">
            <!-- Dashboard Tab -->
            <div id="dashboard-content" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="glass-card rounded-lg p-6 text-center">
                        <h3 class="text-lg font-bold text-gray-700">Tổng số Task</h3>
                        <div class="text-3xl font-bold text-blue-600 mt-2" id="totalTasks">0</div>
                    </div>
                    <div class="glass-card rounded-lg p-6 text-center">
                        <h3 class="text-lg font-bold text-gray-700">Đang thực hiện</h3>
                        <div class="text-3xl font-bold text-orange-600 mt-2" id="inProgressTasks">0</div>
                    </div>
                    <div class="glass-card rounded-lg p-6 text-center">
                        <h3 class="text-lg font-bold text-gray-700">Hoàn thành</h3>
                        <div class="text-3xl font-bold text-green-600 mt-2" id="completedTasks">0</div>
                    </div>
                    <div class="glass-card rounded-lg p-6 text-center">
                        <h3 class="text-lg font-bold text-gray-700">Quá hạn</h3>
                        <div class="text-3xl font-bold text-red-600 mt-2" id="overdueTasks">0</div>
                    </div>
                </div>

                <div class="glass-card rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Task gần đây</h3>
                    <div id="recentTasks">
                        <p class="text-gray-600">Đang tải dữ liệu...</p>
                    </div>
                </div>
            </div>

            <!-- Create Task Tab -->
            <div id="create-content" class="tab-content hidden">
                <div class="glass-card rounded-lg p-8">
                    <h2 class="text-2xl font-bold mb-6">Tạo Task Mới</h2>
                    <form id="createTaskForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">Tên Task *</label>
                                <input type="text" id="taskName" required class="w-full p-3 border rounded-lg focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Dự án</label>
                                <input type="text" id="taskProject" class="w-full p-3 border rounded-lg focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Ngày bắt đầu</label>
                                <input type="date" id="startDate" class="w-full p-3 border rounded-lg focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Ngày kết thúc *</label>
                                <input type="date" id="endDate" required class="w-full p-3 border rounded-lg focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Trạng thái</label>
                                <select id="taskStatus" class="w-full p-3 border rounded-lg focus:border-blue-500 focus:outline-none">
                                    <option value="Todo">Cần làm</option>
                                    <option value="Doing">Đang làm</option>
                                    <option value="Done">Hoàn thành</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Ưu tiên</label>
                                <select id="taskPriority" class="w-full p-3 border rounded-lg focus:border-blue-500 focus:outline-none">
                                    <option value="low">Thấp</option>
                                    <option value="medium">Trung bình</option>
                                    <option value="high">Cao</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Mô tả</label>
                            <textarea id="taskDescription" rows="4" class="w-full p-3 border rounded-lg focus:border-blue-500 focus:outline-none"></textarea>
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition flex items-center">
                                <span class="loading hidden w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></span>
                                Tạo Task
                            </button>
                            <button type="reset" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition">
                                Reset
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Manage Tasks Tab -->
            <div id="manage-content" class="tab-content hidden">
                <div class="glass-card rounded-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Quản lý Task</h2>
                        <button id="refreshTasks" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition flex items-center">
                            <span class="loading hidden w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></span>
                            Làm mới
                        </button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="border border-gray-300 px-4 py-2 text-left">ID</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Tên Task</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Người thực hiện</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Dự án</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Kết thúc</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Trạng thái</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Ưu tiên</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTableBody">
                                <tr>
                                    <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                                        Đang tải dữ liệu từ Google Sheets...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Messages -->
    <div id="messageContainer" class="fixed top-4 right-4 z-50"></div>

    <script>
        // Global variables
        let currentUser = null;
        let appConfig = null;
        let allTasks = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadConfig();
            setupEventListeners();
            updateConnectionStatus();
            
            // Check if configuration exists
            if (!appConfig) {
                showSetupModal();
            } else {
                loadTasks();
            }
        }

        function setupEventListeners() {
            document.getElementById('setupBtn').addEventListener('click', showSetupModal);
            document.getElementById('saveSetup').addEventListener('click', saveConfiguration);
            document.getElementById('testConnection').addEventListener('click', testConnection);
            document.getElementById('createTaskForm').addEventListener('submit', handleCreateTask);
            document.getElementById('refreshTasks').addEventListener('click', loadTasks);
            
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => switchTab(e.target.dataset.tab));
            });
        }

        function loadConfig() {
            const saved = localStorage.getItem('taskManagementConfig');
            if (saved) {
                appConfig = JSON.parse(saved);
            }
        }

        function showSetupModal() {
            document.getElementById('setupModal').classList.remove('hidden');
            if (appConfig) {
                document.getElementById('webAppUrl').value = appConfig.webAppUrl || '';
                document.getElementById('sheetId').value = appConfig.sheetId || '';
            }
        }

        function saveConfiguration() {
            const webAppUrl = document.getElementById('webAppUrl').value.trim();
            const sheetId = document.getElementById('sheetId').value.trim();

            if (!webAppUrl || !sheetId) {
                showMessage('Vui lòng điền đầy đủ thông tin', 'error');
                return;
            }

            appConfig = {
                webAppUrl: webAppUrl,
                sheetId: sheetId,
                configuredAt: new Date().toISOString()
            };

            localStorage.setItem('taskManagementConfig', JSON.stringify(appConfig));
            
            document.getElementById('setupModal').classList.add('hidden');
            updateConnectionStatus();
            showMessage('Đã lưu cấu hình thành công!', 'success');
            loadTasks();
        }

        async function testConnection() {
            if (!appConfig) {
                showMessage('Vui lòng lưu cấu hình trước', 'error');
                return;
            }

            const btn = document.getElementById('testConnection');
            const loading = btn.querySelector('.loading') || document.createElement('span');
            loading.className = 'loading w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2';
            btn.insertBefore(loading, btn.firstChild);

            try {
                const response = await fetch(appConfig.webAppUrl, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'read' })
                });

                const result = await response.json();
                
                if (result.data) {
                    showMessage('Kết nối thành công với Google Sheets!', 'success');
                } else {
                    throw new Error('Không thể đọc dữ liệu');
                }
            } catch (error) {
                showMessage('Lỗi kết nối: ' + error.message, 'error');
            } finally {
                loading.remove();
            }
        }

        function updateConnectionStatus() {
            const statusEl = document.getElementById('connectionStatus');
            const dotEl = document.getElementById('statusDot');
            const textEl = document.getElementById('statusText');

            if (appConfig && appConfig.webAppUrl && appConfig.sheetId) {
                dotEl.classList.remove('bg-red-500');
                dotEl.classList.add('bg-green-500');
                textEl.textContent = 'Đã cấu hình Apps Script';
            } else {
                dotEl.classList.remove('bg-green-500');
                dotEl.classList.add('bg-red-500');
                textEl.textContent = 'Chưa cấu hình Apps Script';
            }
        }

        function switchTab(tabName) {
            // Update active tab button
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                btn.classList.add('text-gray-600');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'border-blue-500', 'text-blue-600');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('text-gray-600');

            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
        }

        async function handleCreateTask(e) {
            e.preventDefault();

            if (!appConfig) {
                showMessage('Vui lòng cấu hình Apps Script trước', 'error');
                return;
            }

            const submitBtn = document.querySelector('#createTaskForm button[type="submit"]');
            const loading = submitBtn.querySelector('.loading');
            loading.classList.remove('hidden');
            submitBtn.disabled = true;

            const taskData = {
                action: 'create',
                id: Date.now().toString(),
                name: document.getElementById('taskName').value.trim(),
                assignee: 'current_user@gmail.com', // Replace with actual user
                project: document.getElementById('taskProject').value.trim() || 'Không có',
                startDate: document.getElementById('startDate').value || new Date().toISOString().split('T')[0],
                endDate: document.getElementById('endDate').value,
                status: document.getElementById('taskStatus').value,
                priority: document.getElementById('taskPriority').value,
                description: document.getElementById('taskDescription').value.trim(),
                creator: 'current_user@gmail.com',
                createdAt: new Date().toISOString()
            };

            if (!taskData.name || !taskData.endDate) {
                showMessage('Vui lòng điền đầy đủ thông tin bắt buộc', 'error');
                loading.classList.add('hidden');
                submitBtn.disabled = false;
                return;
            }

            try {
                const response = await fetch(appConfig.webAppUrl, {
                    method: 'POST',
                    body: JSON.stringify(taskData)
                });

                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('createTaskForm').reset();
                    showMessage('Tạo task thành công!', 'success');
                    loadTasks();
                } else {
                    throw new Error('Không thể tạo task');
                }
            } catch (error) {
                showMessage('Lỗi khi tạo task: ' + error.message, 'error');
            } finally {
                loading.classList.add('hidden');
                submitBtn.disabled = false;
            }
        }

        async function loadTasks() {
            if (!appConfig) {
                return;
            }

            const refreshBtn = document.getElementById('refreshTasks');
            const loading = refreshBtn.querySelector('.loading');
            if (loading) loading.classList.remove('hidden');

            try {
                const response = await fetch(appConfig.webAppUrl, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'read' })
                });

                const result = await response.json();
                
                if (result.data && result.data.length > 1) {
                    // Convert array data to objects (skip header row)
                    allTasks = result.data.slice(1).map(row => ({
                        id: row[0],
                        name: row[1],
                        assignee: row[2],
                        project: row[3],
                        startDate: row[4],
                        endDate: row[5],
                        status: row[6],
                        priority: row[7],
                        description: row[8],
                        creator: row[9],
                        createdAt: row[10]
                    })).filter(task => task.id); // Filter out empty rows

                    renderTasks(allTasks);
                    updateDashboard();
                } else {
                    allTasks = [];
                    renderTasks([]);
                    updateDashboard();
                }
            } catch (error) {
                showMessage('Lỗi khi tải dữ liệu: ' + error.message, 'error');
            } finally {
                if (loading) loading.classList.add('hidden');
            }
        }

        function renderTasks(tasks) {
            const tbody = document.getElementById('tasksTableBody');
            
            if (!tasks || tasks.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="border border-gray-300 px-4 py-8 text-center text-gray-500">
                            Chưa có task nào trong Google Sheets.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = tasks.map(task => `
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-300 px-4 py-2">${task.id?.toString().slice(-6) || 'N/A'}</td>
                    <td class="border border-gray-300 px-4 py-2 font-medium">${task.name || 'N/A'}</td>
                    <td class="border border-gray-300 px-4 py-2">${(task.assignee || '').split('@')[0] || 'N/A'}</td>
                    <td class="border border-gray-300 px-4 py-2">${task.project || 'N/A'}</td>
                    <td class="border border-gray-300 px-4 py-2">${formatDate(task.endDate)}</td>
                    <td class="border border-gray-300 px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs ${getStatusColor(task.status)}">
                            ${getStatusLabel(task.status)}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-2">
                        <span class="px-2 py-1 rounded text-xs ${getPriorityColor(task.priority)}">
                            ${getPriorityLabel(task.priority)}
                        </span>
                    </td>
                    <td class="border border-gray-300 px-4 py-2">
                        <select onchange="updateTaskStatus('${task.id}', this.value)" class="text-xs border rounded px-1 py-1">
                            <option value="Todo" ${task.status === 'Todo' ? 'selected' : ''}>Cần làm</option>
                            <option value="Doing" ${task.status === 'Doing' ? 'selected' : ''}>Đang làm</option>
                            <option value="Done" ${task.status === 'Done' ? 'selected' : ''}>Hoàn thành</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        }

        async function updateTaskStatus(taskId, newStatus) {
            try {
                const response = await fetch(appConfig.webAppUrl, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'update',
                        id: taskId,
                        status: newStatus
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage(`Đã cập nhật trạng thái task thành "${getStatusLabel(newStatus)}"`, 'success');
                    loadTasks();
                } else {
                    throw new Error('Không thể cập nhật task');
                }
            } catch (error) {
                showMessage('Lỗi khi cập nhật: ' + error.message, 'error');
                loadTasks(); // Reload to reset the UI
            }
        }

        function getStatusColor(status) {
            const colors = {
                'Todo': 'bg-yellow-100 text-yellow-800',
                'Doing': 'bg-blue-100 text-blue-800',
                'Done': 'bg-green-100 text-green-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        }

        function getStatusLabel(status) {
            const labels = {
                'Todo': 'Cần làm',
                'Doing': 'Đang làm',
                'Done': 'Hoàn thành'
            };
            return labels[status] || status;
        }

        function getPriorityColor(priority) {
            const colors = {
                'high': 'bg-red-100 text-red-800',
                'medium': 'bg-orange-100 text-orange-800',
                'low': 'bg-gray-100 text-gray-800'
            };
            return colors[priority] || 'bg-gray-100 text-gray-800';
        }

        function getPriorityLabel(priority) {
            const labels = {
                'high': 'Cao',
                'medium': 'Trung bình',
                'low': 'Thấp'
            };
            return labels[priority] || priority;
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('vi-VN');
            } catch {
                return dateString;
            }
        }

        function updateDashboard() {
            const totalTasks = allTasks.length;
            const inProgressTasks = allTasks.filter(t => t.status === 'Doing').length;
            const completedTasks = allTasks.filter(t => t.status === 'Done').length;
            const overdueTasks = allTasks.filter(t => {
                if (!t.endDate) return false;
                try {
                    const endDate = new Date(t.endDate);
                    const today = new Date();
                    return endDate < today && t.status !== 'Done';
                } catch {
                    return false;
                }
            }).length;

            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('inProgressTasks').textContent = inProgressTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('overdueTasks').textContent = overdueTasks;

            // Update recent tasks
            const recentTasks = allTasks
                .filter(t => t.createdAt)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 5);

            const recentTasksContainer = document.getElementById('recentTasks');
            if (recentTasks.length === 0) {
                recentTasksContainer.innerHTML = '<p class="text-gray-600">Chưa có task nào. Hãy tạo task đầu tiên!</p>';
            } else {
                recentTasksContainer.innerHTML = recentTasks.map(task => `
                    <div class="flex justify-between items-center py-3 border-b last:border-b-0">
                        <div>
                            <div class="font-medium">${task.name || 'Không có tên'}</div>
                            <div class="text-sm text-gray-600">${task.project || 'Không có dự án'} • Hạn: ${formatDate(task.endDate)}</div>
                        </div>
                        <span class="px-2 py-1 rounded text-xs ${getStatusColor(task.status)}">
                            ${getStatusLabel(task.status)}
                        </span>
                    </div>
                `).join('');
            }
        }

        function showMessage(message, type = 'info', duration = 5000) {
            const container = document.getElementById('messageContainer');
            const messageEl = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };

            messageEl.className = `${colors[type]} text-white p-4 rounded-lg mb-2 shadow-lg max-w-md`;
            messageEl.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1 text-sm">${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white opacity-70 hover:opacity-100">
                        ×
                    </button>
                </div>
            `;

            container.appendChild(messageEl);

            setTimeout(() => {
                if (messageEl.parentElement) {
                    messageEl.remove();
                }
            }, duration);
        }

        // Expose functions globally for onclick handlers
        window.updateTaskStatus = updateTaskStatus;

        // Auto-refresh tasks every 30 seconds
        setInterval(() => {
            if (appConfig) {
                loadTasks();
            }
        }, 30000);
    </script>
</body>
</html>